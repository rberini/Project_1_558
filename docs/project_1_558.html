<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robert Berini &amp; Robert Ferrand">

<title>ST 558 Project One</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ST 558 Project One</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Robert Berini &amp; Robert Ferrand </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="project-overview" class="level2">
<h2 class="anchored" data-anchor-id="project-overview">Project Overview</h2>
<p>Our goal is to write functions that will manipulate and process data sets that come from a census API. We will query the Public Use Microdata Sample (PUMS) Census API, creating a function that allows the user to call the API with different combinations of variables. We’ll then create generic functions to automatically summarize and plot certain returned data, providing numerical and graphical summaries. Lastly, we’ll write up this document via quarto to describe our thought process and give examples of using the functions.</p>
</section>
<section id="required-packages" class="level2">
<h2 class="anchored" data-anchor-id="required-packages">Required Packages</h2>
<p>Load required packages for project.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantreg)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(roxygen2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<p>Before creating a function with the API, we first had to validate the integrity of variables. Considering that we have both numerical and categorical variables, we decided to look through each and account for the factors and numerical ranges as appropriate. After validating the variables, we created the API. The API is created so that it prints out the requested categorical, numerical, and time variables with conditions and geographical subset. The user has free rein to choose one or multiple of each type of variable, and if a user would like to select multiple years of data, the <code>multi_api</code> function allows them to do so.</p>
<section id="prepare-time-variables" class="level3">
<h3 class="anchored" data-anchor-id="prepare-time-variables">Prepare Time Variables</h3>
<p>The time variables need to be handled slightly differently than the other numeric variables. Since there are NA’s, and also since we are working with a range of values, we have decided to find the median (or exact middle) of each time to use for <code>JWAP</code> and <code>JWDP</code>. In particular, <code>JWAP</code> is the time of arrival at work by hour and minute, and <code>JWDP</code> is the time of departure for work by hour and minute. Before we run the API function, we first decided to create a median time table for <code>JWAP</code> and <code>JWDP</code>.</p>
<p>First, create <code>JWAP</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>URL_jwap <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/JWAP.json"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>jwap_time_table <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_jwap)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>jwap_time_table <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(jwap_time_table<span class="sc">$</span>content))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>jwap_time_table <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(jwap_time_table<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>jwap_time_table <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(jwap_time_table,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(jwap_time_table),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(range, <span class="at">delim =</span> <span class="st">" "</span>, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"AMPM1"</span>, <span class="st">"to"</span>, <span class="st">"time2"</span>, <span class="st">"AMPM2"</span>)) </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>jwap_time_table <span class="ot">&lt;-</span> jwap_time_table <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_time =</span> <span class="fu">if_else</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    AMPM1 <span class="sc">==</span> <span class="st">"a.m."</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    hms<span class="sc">::</span><span class="fu">as_hms</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time1) <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      ((hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time2) <span class="sc">-</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>          hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time1)) <span class="sc">/</span> <span class="dv">2</span>)),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>     hms<span class="sc">::</span><span class="fu">as_hms</span>(hms<span class="sc">::</span><span class="fu">parse_hm</span>(<span class="st">"12:00"</span>) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                   hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time1) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                   ((hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time2) <span class="sc">-</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                       hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwap_time_table<span class="sc">$</span>time1)) <span class="sc">/</span> <span class="dv">2</span>)))) <span class="sc">|&gt;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_time =</span> <span class="fu">if_else</span>(median_time <span class="sc">&gt;</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:00:00"</span>) <span class="sc">&amp;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                                 median_time <span class="sc">&lt;</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:59:59"</span>) <span class="sc">&amp;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                                 AMPM1 <span class="sc">==</span> <span class="st">"a.m."</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                               median_time <span class="sc">-</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:00:00"</span>),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                               median_time)) <span class="sc">|&gt;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code, median_time) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(median_time) <span class="sc">|&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">code =</span> <span class="st">"0"</span>, <span class="at">median_time =</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="cn">NA</span>))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>jwap_time_table<span class="sc">$</span>code <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(jwap_time_table<span class="sc">$</span>code)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>jwap_time_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 286 × 2
    code median_time
   &lt;dbl&gt; &lt;time&gt;     
 1     1 02'00"     
 2     2 07'00"     
 3     3 12'00"     
 4     4 17'00"     
 5     5 22'00"     
 6     6 27'00"     
 7     7 34'30"     
 8     8 42'00"     
 9     9 47'00"     
10    10 54'30"     
# ℹ 276 more rows</code></pre>
</div>
</div>
<p>Second, create <code>JWDP</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>URL_jwdp <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/JWDP.json"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>jwdp_time_table <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_jwdp)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>jwdp_time_table <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(jwdp_time_table<span class="sc">$</span>content))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>jwdp_time_table <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(jwdp_time_table<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>jwdp_time_table <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(jwdp_time_table,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(jwdp_time_table),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(range, <span class="at">delim =</span> <span class="st">" "</span>, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"AMPM1"</span>, <span class="st">"to"</span>, <span class="st">"time2"</span>, <span class="st">"AMPM2"</span>)) </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>jwdp_time_table <span class="ot">&lt;-</span> jwdp_time_table <span class="sc">|&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_time =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    AMPM1 <span class="sc">==</span> <span class="st">"a.m."</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    hms<span class="sc">::</span><span class="fu">as_hms</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time1) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      ((hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time2) <span class="sc">-</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>          hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time1)) <span class="sc">/</span> <span class="dv">2</span>)),</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>     hms<span class="sc">::</span><span class="fu">as_hms</span>(hms<span class="sc">::</span><span class="fu">parse_hm</span>(<span class="st">"12:00"</span>) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                   hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time1) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                   ((hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time2) <span class="sc">-</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                       hms<span class="sc">::</span><span class="fu">parse_hm</span>(jwdp_time_table<span class="sc">$</span>time1)) <span class="sc">/</span> <span class="dv">2</span>)))) <span class="sc">|&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_time =</span> <span class="fu">if_else</span>(median_time <span class="sc">&gt;</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:00:00"</span>) <span class="sc">&amp;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                 median_time <span class="sc">&lt;</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:59:59"</span>) <span class="sc">&amp;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                 AMPM1 <span class="sc">==</span> <span class="st">"a.m."</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                               median_time <span class="sc">-</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="st">"12:00:00"</span>),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                               median_time)) <span class="sc">|&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code, median_time) <span class="sc">|&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(median_time) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">code =</span> <span class="st">"0"</span>, <span class="at">median_time =</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="cn">NA</span>))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>jwdp_time_table<span class="sc">$</span>code <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(jwdp_time_table<span class="sc">$</span>code)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>jwdp_time_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 151 × 2
    code median_time
   &lt;dbl&gt; &lt;time&gt;     
 1     1 00:14:30   
 2     2 00:44:30   
 3     3 01:14:30   
 4     4 01:44:30   
 5     5 02:14:30   
 6     6 02:44:30   
 7     7 03:04:30   
 8     8 03:14:30   
 9     9 03:24:30   
10    10 03:34:30   
# ℹ 141 more rows</code></pre>
</div>
</div>
</section>
<section id="prepare-factor-levels" class="level3">
<h3 class="anchored" data-anchor-id="prepare-factor-levels">Prepare Factor Levels</h3>
<p>For categorical variables, call variable descriptions to retrieve factor levels and labels. Then, with similar logic to the time variables, make sure that the corresponding factors are in the correct places. Furthermore, make sure the logic is cohesive and able to be called by the API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>URL_SCHL <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/SCHL.json"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>SCHL_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_SCHL)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>SCHL_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(SCHL_vars<span class="sc">$</span>content))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>SCHL_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(SCHL_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>SCHL_codes <span class="ot">&lt;-</span> SCHL_varstibble <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(SCHL_varstibble), <span class="at">names_to =</span> <span class="st">"code"</span>, <span class="at">values_to =</span> <span class="st">"range"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code =</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(code) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">substr</span>(code, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">"0"</span>, <span class="fu">substr</span>(code, <span class="dv">2</span>, <span class="dv">2</span>), code))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>URL_SCH <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/SCH.json"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>SCH_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_SCH)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>SCH_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(SCH_vars<span class="sc">$</span>content))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>SCH_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(SCH_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>SCH_codes <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(SCH_varstibble,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(SCH_varstibble),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>URL_HHL <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/HHL.json"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>HHL_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_HHL)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>HHL_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(HHL_vars<span class="sc">$</span>content))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>HHL_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(HHL_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>HHL_codes <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(HHL_varstibble,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HHL_varstibble),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>URL_JWTRNS <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/JWTRNS.json"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>JWTRNS_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_JWTRNS)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>JWTRNS_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(JWTRNS_vars<span class="sc">$</span>content))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>JWTRNS_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(JWTRNS_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>JWTRNS_codes <span class="ot">&lt;-</span> JWTRNS_varstibble <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(JWTRNS_varstibble), <span class="at">names_to =</span> <span class="st">"code"</span>, <span class="at">values_to =</span> <span class="st">"range"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code =</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(code) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">substr</span>(code, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">"0"</span>, <span class="fu">substr</span>(code, <span class="dv">2</span>, <span class="dv">2</span>), code))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>URL_HISPEED <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/HISPEED.json"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>HISPEED_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_HISPEED)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>HISPEED_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(HISPEED_vars<span class="sc">$</span>content))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>HISPEED_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(HISPEED_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>HISPEED_codes <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(HISPEED_varstibble,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HISPEED_varstibble),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>URL_FER <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/FER.json"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>FER_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_FER)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>FER_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(FER_vars<span class="sc">$</span>content))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>FER_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(FER_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>FER_codes <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(FER_varstibble,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(FER_varstibble),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>URL_SEX <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/SEX.json"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>SEX_vars <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_SEX)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>SEX_varsnow <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(SEX_vars<span class="sc">$</span>content))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>SEX_varstibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(SEX_varsnow<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>SEX_codes <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(SEX_varstibble,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(SEX_varstibble),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"code"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that this is complete, we can finish Data Processing by creating the API.</p>
</section>
<section id="create-the-api" class="level3">
<h3 class="anchored" data-anchor-id="create-the-api">Create the API</h3>
<p>The API starts by creating blank variables so that a clean slate is run each time. Then, global valid variables of each possible user selection (numerical, categorical, date, and geographical level) are listed for use in the API and later functions. Specific decisions are outlined in documentation and comments within the function.</p>
<p>First, global variables are initialized and valid inputs are established.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' setup global variables to be returned</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' @noRd</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#blank variables for clean slate</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>census_tib <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">data.frame</span>())</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>cat_var <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#all possible variable values</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>valid_num_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"PWGTP"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>valid_date_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>valid_cat_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>, <span class="st">"SEX"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>valid_geo_level <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ALL"</span>, <span class="st">"REGION"</span>, <span class="st">"DIVISION"</span>, <span class="st">"STATE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, a helper function is created. Note that the helper function both takes in the URL with <code>GET</code> and also creates a tibble. The tibble is then formatted, wrangled, and massaged to be nice and neat. The tibble deletes duplicate columns and uses all the ranges assigned before to correctly display the categorical factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>get_url <span class="ot">&lt;-</span> <span class="cf">function</span>(URL_id) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  census_info <span class="ot">&lt;-</span> <span class="fu">GET</span>(URL_id)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  census_df <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(census_info<span class="sc">$</span>content))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a tibble</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  census_tib <span class="ot">&lt;-</span> census_df <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#append columns to the tibble based on the selected variables from before</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (column <span class="cf">in</span> <span class="fu">colnames</span>(census_tib)) {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (column <span class="sc">%in%</span> valid_date_var) {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      census_tib[[column]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(census_tib[[column]])</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (column <span class="sc">%in%</span> valid_num_var) {</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        census_tib[[column]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(census_tib[[column]])</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (column <span class="sc">%in%</span> valid_cat_var) {</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>          census_tib[[column]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(census_tib[[column]])</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create statements for the time variables that formats them based on the definitions from up above if they are present.</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">str_detect</span>(URL_id,<span class="st">"JWAP"</span>)) {</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        jwap_time_table,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"JWAP"</span> <span class="ot">=</span> <span class="st">"code"</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>JWAP) <span class="sc">|&gt;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">JWAP =</span> median_time)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">str_detect</span>(URL_id,<span class="st">"JWDP"</span>)) {</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        jwap_time_table,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"JWDP"</span> <span class="ot">=</span> <span class="st">"code"</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>JWDP) <span class="sc">|&gt;</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">JWDP =</span> median_time)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the sex based on above designated factor level</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"SEX"</span>)) {</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        SEX_codes,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"SEX"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>SEX) <span class="sc">|&gt;</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">SEX =</span> range)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the fer based on above designated factor level</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"FER"</span>)) {</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>        FER_codes,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"FER"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>FER) <span class="sc">|&gt;</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">FER =</span> range)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the HISPEED based on above designated factor level</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"HISPEED"</span>)) {</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>        HISPEED_codes,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"HISPEED"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>HISPEED) <span class="sc">|&gt;</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">HISPEED =</span> range)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the SCH based on above designated factor level</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#notice we had to take SCH as an exact string to not mess with SCHL</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"</span><span class="sc">\\</span><span class="st">bSCH</span><span class="sc">\\</span><span class="st">b"</span>)) {</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>        SCH_codes,</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"SCH"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>SCH) <span class="sc">|&gt;</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">SCH =</span> range)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the HHL based on above designated factor level</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"HHL"</span>)) {</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>        HHL_codes,</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"HHL"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>HHL) <span class="sc">|&gt;</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">HHL =</span> range)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the JWTRNS based on above designated factor level</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"JWTRNS"</span>)) {</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>        JWTRNS_codes,</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"JWTRNS"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>JWTRNS) <span class="sc">|&gt;</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">JWTRNS =</span> range)</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>  <span class="co">#format the SCHL based on above designated factor level</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(URL_id, <span class="st">"SCHL"</span>)) {</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>    census_tib <span class="ot">&lt;-</span> census_tib <span class="sc">|&gt;</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>        SCHL_codes,</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"SCHL"</span> <span class="ot">=</span> <span class="st">"code"</span>) </span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>SCHL) <span class="sc">|&gt;</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">SCHL =</span> range)</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Function for creating data assigns a class of census to resulting tibble</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @noRd</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(census_tib) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"census"</span>, <span class="fu">class</span>(census_tib))</span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Ensure resulting tibble (census_tib) and selected variables are returned to the global environment for use in other functions and analysis</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Superassigmment operator (&lt;&lt;-) is intentional to ensure local variables are passed to the global environment</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' A list including num_var, cat_var and census_tib is returned for redudancy and convenience so user assign function to an object and then specify the corresponding version of the variable created</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @noRd</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>  num_var <span class="ot">&lt;&lt;-</span> num_var</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>  cat_var <span class="ot">&lt;&lt;-</span> cat_var</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>  census_tib <span class="ot">&lt;&lt;-</span> census_tib</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>api_query</code> function takes in the desired user variables and calls the census data api to take in those values. The variables are taken as columns, and then are sent to the <code>get_url</code> helper function. There are many cleaning techniques used to correctly concatenate the different variables as well as adding conditions and subsets. The numerical variables, categorical variables, and final tibble is returned as a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Begin query building</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Numeric variable PWGTP is required for function and always called so is not included as a default that can be overwritten</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @noRd</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>api_query <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">surv_year =</span> <span class="st">"2022"</span>, <span class="at">num_var =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>), <span class="at">cat_var =</span> <span class="st">"SEX"</span>, <span class="at">geo_level =</span> <span class="st">"ALL"</span>, <span class="at">condition =</span> <span class="cn">NULL</span>, <span class="at">geo_subset =</span> <span class="st">"STATE:11"</span>) {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ensure user selection is within permissible values</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (surv_year <span class="sc">&lt;</span> <span class="dv">2010</span> <span class="sc">||</span> surv_year <span class="sc">&gt;</span> <span class="dv">2022</span> <span class="sc">||</span> surv_year <span class="sc">==</span> <span class="dv">2020</span>) {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Year must be between 2010 and 2022, excluding 2020."</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>num_var <span class="sc">%in%</span> valid_num_var)) {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid Numeric Variable"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>cat_var <span class="sc">%in%</span> valid_cat_var)) {</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid Categorical Variable"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>geo_level <span class="sc">%in%</span> valid_geo_level)) {</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(geo_level)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid Geography Level"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#output unique usable strings for the numerical, categorical, and geo level variables</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  num_var_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">unique</span>(num_var), <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  cat_var_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">unique</span>(cat_var), <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#if geo level is all, then don't do anything, else then start it as null to be replaced</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>geo_level <span class="sc">==</span> <span class="st">"ALL"</span>) {</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    geo_level_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">unique</span>(geo_level), <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    geo_level_string <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#start with the URl base, and then append the required numerical, categorical, and geo level with the designated survey years</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  URL_base <span class="ot">&lt;-</span> <span class="st">"https://api.census.gov/data/"</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  URL_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(URL_base, surv_year, <span class="st">"/acs/acs1/pums?get=PWGTP,"</span>, num_var_string, <span class="st">","</span>, cat_var_string, <span class="st">","</span>,geo_level_string)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#make room for conditions, including subsetting by cat/num and also by region</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(condition)) {</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    condition_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(condition, <span class="at">collapse =</span> <span class="st">"&amp;"</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    URL_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(URL_id, <span class="st">"&amp;"</span>, condition_string)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(geo_subset)) {</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    region_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(geo_subset, <span class="at">collapse =</span> <span class="st">"&amp;"</span>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    URL_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(URL_id, <span class="st">"&amp;for="</span>, region_string)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#allow user to see their finalized url, then parse it for parameters</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(URL_id)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  parsed_url <span class="ot">&lt;-</span> <span class="fu">parse_url</span>(URL_id)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pipe to fix spacing and commas, otherwise error</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  parsed_url<span class="sc">$</span>query<span class="sc">$</span>get <span class="ot">&lt;-</span> parsed_url<span class="sc">$</span>query<span class="sc">$</span>get <span class="sc">|&gt;</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setdiff</span>(<span class="fu">names</span>(parsed_url<span class="sc">$</span>query)) <span class="sc">|&gt;</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#clean up url</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  URL_id <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"%2C"</span>, <span class="st">","</span>, <span class="fu">build_url</span>(parsed_url))</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#call the helper function defined before!</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_url</span>(URL_id)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_var =</span> num_var,</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_var =</span> cat_var,</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">census_tib =</span> census_tib</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multi-year-api" class="level3">
<h3 class="anchored" data-anchor-id="multi-year-api">Multi-Year API</h3>
<p>This function takes the <code>api_query</code> function and allows the user, along with the previous defaults from that function, to select multiple years and return one large tibble that binds the multiple years by row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#using ..., we can actually also call the api_query function along with specifying multiple surv_years</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>multi_api <span class="ot">&lt;-</span> <span class="cf">function</span>(surv_years, ...) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  multi_tibs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(surv_years, <span class="cf">function</span>(surv_year) {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#calls api_query</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    tib_call <span class="ot">&lt;-</span> <span class="fu">api_query</span>(<span class="at">surv_year =</span> surv_year, ...)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    final_tib <span class="ot">&lt;-</span> tib_call<span class="sc">$</span>census_tib</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    final_tib <span class="ot">&lt;-</span> final_tib  <span class="sc">|&gt;</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#allows us to concatenate the correct surv_year </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">surv_year =</span> surv_year)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(final_tib)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  entire_tib <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(multi_tibs)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#the tibble with all years rowbinded</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(entire_tib)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-the-api-function" class="level3">
<h3 class="anchored" data-anchor-id="test-the-api-function">Test the API Function</h3>
<p>Ensure the <code>api_query</code> function is working properly by feeding in some numeric, date, and categorical variables. Furthermore, let’s condition on <code>ALL</code>, with <code>AGEP=30</code> and subsetting the appropriate state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">api_query</span>(<span class="at">surv_year =</span> <span class="st">"2022"</span>, <span class="at">num_var =</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"PWGTP"</span>), <span class="at">cat_var =</span> <span class="fu">c</span>(<span class="st">"HISPEED"</span>, <span class="st">"SCHL"</span>, <span class="st">"SCH"</span>, <span class="st">"FER"</span>, <span class="st">"SEX"</span>, <span class="st">"SEX"</span>), <span class="at">geo_level =</span> <span class="st">"ALL"</span>, <span class="at">condition =</span> <span class="st">"AGEP=30"</span>, <span class="at">geo_subset =</span> <span class="st">"STATE:11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2022/acs/acs1/pums?get=PWGTP,AGEP,PWGTP,HISPEED,SCHL,SCH,FER,SEX,&amp;AGEP=30&amp;for=STATE:11"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$num_var
[1] "AGEP"  "PWGTP"

$cat_var
[1] "HISPEED" "SCHL"    "SCH"     "FER"     "SEX"     "SEX"    

$census_tib
# A tibble: 156 × 8
   PWGTP  AGEP state SEX    FER                              HISPEED SCH   SCHL 
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;                            &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
 1   129    30 11    Female No                               Yes     No, … Mast…
 2    90    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Some…
 3    86    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Bach…
 4    69    30 11    Female No                               Yes     No, … Mast…
 5   342    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Mast…
 6    40    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Bach…
 7    77    30 11    Female No                               Yes     No, … Mast…
 8   100    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Mast…
 9    30    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Bach…
10   339    30 11    Male   N/A (less than 15 years/greater… Yes     No, … Bach…
# ℹ 146 more rows</code></pre>
</div>
</div>
<p>Voila! Notice that we output our respective link, the numerical and categorical variables, and the final tibble. Also, any duplicate columns called through user error are removed!</p>
</section>
<section id="test-the-multi-api-function" class="level3">
<h3 class="anchored" data-anchor-id="test-the-multi-api-function">Test the Multi-API Function</h3>
<p>Ensure the <code>multi_api</code> function is working properly by combining years and feeding in some numeric, date, and categorical variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_api</span>(<span class="at">surv_years =</span> <span class="fu">c</span>(<span class="st">"2015"</span>, <span class="st">"2021"</span>), <span class="at">num_var =</span> <span class="fu">c</span>(<span class="st">"JWDP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"GRPIP"</span>), <span class="at">cat_var =</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"SEX"</span>), <span class="at">condition=</span><span class="st">"SEX=1"</span>, <span class="at">geo_subset=</span> <span class="st">"STATE:11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2015/acs/acs1/pums?get=PWGTP,JWDP,GRPIP,FER,HHL,SEX,&amp;SEX=1&amp;for=STATE:11"
[1] "https://api.census.gov/data/2021/acs/acs1/pums?get=PWGTP,JWDP,GRPIP,FER,HHL,SEX,&amp;SEX=1&amp;for=STATE:11"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,424 × 8
   PWGTP GRPIP state JWDP   SEX   FER                            HHL   surv_year
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;time&gt; &lt;chr&gt; &lt;chr&gt;                          &lt;chr&gt; &lt;chr&gt;    
 1    18     0 11    03:32  Male  N/A (less than 15 years/great… N/A … 2015     
 2    28    22 11    04:47  Male  N/A (less than 15 years/great… Engl… 2015     
 3    50    22 11       NA  Male  N/A (less than 15 years/great… Engl… 2015     
 4    81    65 11    05:07  Male  N/A (less than 15 years/great… Othe… 2015     
 5    80    65 11       NA  Male  N/A (less than 15 years/great… Othe… 2015     
 6    64    65 11       NA  Male  N/A (less than 15 years/great… Othe… 2015     
 7    63     0 11    04:17  Male  N/A (less than 15 years/great… Engl… 2015     
 8   130     0 11       NA  Male  N/A (less than 15 years/great… Engl… 2015     
 9    36     0 11       NA  Male  N/A (less than 15 years/great… Engl… 2015     
10   210    28 11    03:32  Male  N/A (less than 15 years/great… Engl… 2015     
# ℹ 6,414 more rows</code></pre>
</div>
</div>
<p>Voila! Notice that we output our respective link, the numerical and categorical variables, and the final tibble. Also, any duplicate columns called through user error are removed! Furthermore, we wanted to show that we can condition on categorical variables, and our tibble correctly rowbinds.</p>
<p>Finally, test the empty function call (i.e., test the default query) to reflect assigned `state` of 11 (i.e., DC). This is the tibble to be used in creating summaries below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#this should be last call to api_query, which establishes defaults for summary functions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>default_query <span class="ot">&lt;-</span> <span class="fu">api_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2022/acs/acs1/pums?get=PWGTP,AGEP,PWGTP,SEX,&amp;for=STATE:11"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>default_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$num_var
[1] "AGEP"  "PWGTP"

$cat_var
[1] "SEX"

$census_tib
# A tibble: 6,718 × 4
   PWGTP  AGEP state SEX   
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1    81    18 11    Female
 2    67    18 11    Female
 3    85    19 11    Male  
 4    51    18 11    Male  
 5    56    23 11    Female
 6    80    20 11    Male  
 7   213    34 11    Female
 8   175    66 11    Male  
 9    84    24 11    Male  
10    62    19 11    Female
# ℹ 6,708 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="writing-a-generic-function-for-summarizing" class="level2">
<h2 class="anchored" data-anchor-id="writing-a-generic-function-for-summarizing">Writing a Generic Function for Summarizing</h2>
<p>For the variables returned from the API call (or some subset thereof), generate specific numeric and graphical summaries to describe the data.</p>
<section id="numeric-summary" class="level3">
<h3 class="anchored" data-anchor-id="numeric-summary">Numeric Summary</h3>
<p>Write a function that produces means and standard deviations for our numeric variable(s) and counts for our categorical variable(s).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>census_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">tib =</span> census_tib, <span class="at">cat_var_s =</span> <span class="fu">c</span>(<span class="fu">intersect</span>(<span class="fu">colnames</span>(census_tib), valid_cat_var)), <span class="at">num_var_s =</span> <span class="fu">c</span>(<span class="fu">setdiff</span>(<span class="fu">intersect</span>(<span class="fu">colnames</span>(census_tib), valid_num_var), <span class="st">"PWGTP"</span>))) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' function takes in variables used in api query call to find descriptive stratistics</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' defaults to variables from most recent census_tib return</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @noRd</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#initialize lists</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  sample_means <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  sample_sds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  all_counts <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculates all numericals minus jwdp and jwap and the weights</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(name <span class="cf">in</span> num_var_s) {</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">colnames</span>(tib) <span class="sc">&amp;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>       name <span class="sc">%in%</span> valid_num_var <span class="sc">&amp;</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>       <span class="sc">!</span>name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PWGTP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWAP"</span>)) {</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      sample_mean <span class="ot">&lt;-</span> <span class="fu">sum</span>(tib[[name]] <span class="sc">*</span> tib<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(tib<span class="sc">$</span>PWGTP)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      sample_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((tib[[name]]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>tib<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(tib<span class="sc">$</span>PWGTP)<span class="sc">-</span>sample_mean<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      sample_means[[name]] <span class="ot">&lt;-</span> sample_mean</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      sample_sds[[name]] <span class="ot">&lt;-</span> sample_sd</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#calculates times in a different way due to NA's and time</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>)) {</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      tib <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(tib)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      sample_mean <span class="ot">&lt;-</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(tib[[name]]) <span class="sc">*</span> tib<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(tib<span class="sc">$</span>PWGTP))</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>      sample_sd <span class="ot">&lt;-</span> (<span class="fu">sqrt</span>(<span class="fu">sum</span>((<span class="fu">as.numeric</span>(tib[[name]])<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>tib<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(tib<span class="sc">$</span>PWGTP)<span class="sc">-</span>sample_mean<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      sample_mean <span class="ot">&lt;-</span> hms<span class="sc">::</span><span class="fu">round_hms</span>(hms<span class="sc">::</span><span class="fu">as_hms</span>(sample_mean), <span class="at">secs =</span> <span class="dv">1</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      sample_sd <span class="ot">&lt;-</span> hms<span class="sc">::</span><span class="fu">round_hms</span>(hms<span class="sc">::</span><span class="fu">as_hms</span>(sample_sd), <span class="at">secs =</span> <span class="dv">1</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>      sample_means[[name]] <span class="ot">&lt;-</span> sample_mean</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>      sample_sds[[name]] <span class="ot">&lt;-</span> sample_sd</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Please enter numeric variables used in API call except PWGTP"</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#categorical variable counts</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(name <span class="cf">in</span> cat_var_s) {</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">colnames</span>(tib) <span class="sc">&amp;</span> name <span class="sc">%in%</span> valid_cat_var) {</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>      counts <span class="ot">&lt;-</span> tib <span class="sc">|&gt;</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(tib[[name]]) <span class="sc">|&gt;</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(<span class="sc">~</span> name, <span class="dv">1</span>)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>      all_counts[[name]] <span class="ot">&lt;-</span> counts</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Please enter categorical variables used in API call"</span>)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return as a named list</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">sample_means =</span> sample_means, <span class="at">sample_sds =</span> sample_sds, <span class="at">all_counts =</span> all_counts))</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test out this function by running <code>census_summary</code> on <code>SEX</code> and <code>AGEP</code> variables per the default <code>api_query</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cen_sum <span class="ot">&lt;-</span> <span class="fu">census_summary</span>(<span class="at">cat_var_s =</span> <span class="st">"SEX"</span>, <span class="at">num_var_s =</span> <span class="st">"AGEP"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cen_sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sample_means
$sample_means$AGEP
[1] 37.05794


$sample_sds
$sample_sds$AGEP
[1] 21.39444


$all_counts
$all_counts$SEX
# A tibble: 2 × 2
  SEX    count
  &lt;chr&gt;  &lt;int&gt;
1 Female  3583
2 Male    3135</code></pre>
</div>
</div>
<p>Validate that the call above returns the same output as an empty function call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>default_cen_sum <span class="ot">&lt;-</span> <span class="fu">census_summary</span>()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(default_cen_sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sample_means
$sample_means$AGEP
[1] 37.05794


$sample_sds
$sample_sds$AGEP
[1] 21.39444


$all_counts
$all_counts$SEX
# A tibble: 2 × 2
  SEX    count
  &lt;chr&gt;  &lt;int&gt;
1 Female  3583
2 Male    3135</code></pre>
</div>
</div>
<p>If you are interested in a more complex census summary, we can use our <code>multi_api</code> function from earlier. It will still be compatible:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_api</span>(<span class="at">surv_years =</span> <span class="fu">c</span>(<span class="st">"2015"</span>, <span class="st">"2021"</span>), <span class="at">num_var =</span> <span class="fu">c</span>(<span class="st">"JWDP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"GRPIP"</span>), <span class="at">cat_var =</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"SEX"</span>), <span class="at">condition=</span><span class="st">"SEX=1"</span>, <span class="at">geo_subset=</span> <span class="st">"STATE:11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2015/acs/acs1/pums?get=PWGTP,JWDP,GRPIP,FER,HHL,SEX,&amp;SEX=1&amp;for=STATE:11"
[1] "https://api.census.gov/data/2021/acs/acs1/pums?get=PWGTP,JWDP,GRPIP,FER,HHL,SEX,&amp;SEX=1&amp;for=STATE:11"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,424 × 8
   PWGTP GRPIP state JWDP   SEX   FER                            HHL   surv_year
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;time&gt; &lt;chr&gt; &lt;chr&gt;                          &lt;chr&gt; &lt;chr&gt;    
 1   167    25 11    04:02  Male  N/A (less than 15 years/great… Engl… 2015     
 2    58     0 11       NA  Male  N/A (less than 15 years/great… Span… 2015     
 3    41     0 11       NA  Male  N/A (less than 15 years/great… Span… 2015     
 4   265    19 11    02:47  Male  N/A (less than 15 years/great… Span… 2015     
 5   292    19 11    02:47  Male  N/A (less than 15 years/great… Span… 2015     
 6   207    19 11    02:47  Male  N/A (less than 15 years/great… Span… 2015     
 7    75     0 11    03:32  Male  N/A (less than 15 years/great… Engl… 2015     
 8    37    38 11    04:32  Male  N/A (less than 15 years/great… Engl… 2015     
 9    61     0 11       NA  Male  N/A (less than 15 years/great… N/A … 2015     
10   161     0 11    09:17  Male  N/A (less than 15 years/great… Engl… 2015     
# ℹ 6,414 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sample_means
$sample_means$GRPIP
[1] 16.80561

$sample_means$JWDP
05:02:38


$sample_sds
$sample_sds$GRPIP
[1] 26.64306

$sample_sds$JWDP
02:22:48


$all_counts
$all_counts$SEX
# A tibble: 1 × 2
  SEX   count
  &lt;chr&gt; &lt;int&gt;
1 Male    964

$all_counts$FER
# A tibble: 1 × 2
  FER                                                  count
  &lt;chr&gt;                                                &lt;int&gt;
1 N/A (less than 15 years/greater than 50 years/ male)   964

$all_counts$HHL
# A tibble: 6 × 2
  HHL                                count
  &lt;chr&gt;                              &lt;int&gt;
1 Asian and Pacific Island languages    12
2 English Only                         659
3 N/A (GQ/vacant)                       61
4 Other Indo-European languages         70
5 Other Language                        44
6 Spanish                              118</code></pre>
</div>
</div>
<p>Notice that we output a named list for the means and standard deviations of the called variables, where duplicates are ignored. Furthermore, we created a function that outputs all count data for each categorical variable. It also works on time! I set it back to the default query as well.</p>
<p>Setting it back to the default query for the next steps,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>default_query <span class="ot">&lt;-</span> <span class="fu">api_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2022/acs/acs1/pums?get=PWGTP,AGEP,PWGTP,SEX,&amp;for=STATE:11"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>default_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$num_var
[1] "AGEP"  "PWGTP"

$cat_var
[1] "SEX"

$census_tib
# A tibble: 6,718 × 4
   PWGTP  AGEP state SEX   
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1    81    18 11    Female
 2    67    18 11    Female
 3    85    19 11    Male  
 4    51    18 11    Male  
 5    56    23 11    Female
 6    80    20 11    Male  
 7   213    34 11    Female
 8   175    66 11    Male  
 9    84    24 11    Male  
10    62    19 11    Female
# ℹ 6,708 more rows</code></pre>
</div>
</div>
</section>
<section id="graphical-summary" class="level3">
<h3 class="anchored" data-anchor-id="graphical-summary">Graphical Summary</h3>
<p>Create a generic <code>plot()</code> function for a census class tibble. Require the user to specify one categorical variable and one numeric variable for plotting purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>census_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">tib =</span> census_tib, cat_var_s, num_var_s) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' function generates a boxplot based upon one numeric and one categorical variable from api_query call</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' defaults most recent tibble returned from api_query</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @noRd</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plots numerial using tib sans weight variable  </span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(name <span class="cf">in</span> num_var_s) {</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">colnames</span>(tib) <span class="sc">&amp;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>       name <span class="sc">%in%</span> valid_num_var <span class="sc">&amp;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>       name <span class="sc">!=</span> <span class="st">"PWGTP"</span>) {</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> tib[[name]]</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Please enter numeric variables used in API call"</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plots categorical using tib</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(name <span class="cf">in</span> cat_var_s) {</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">colnames</span>(tib) <span class="sc">&amp;</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>       name <span class="sc">%in%</span> valid_cat_var) {</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> tib[[name]]</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Please enter categorical variables used in API call"</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#boxplot calls x and y variables from for loops above  </span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(tib,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">weight =</span> PWGTP)) <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(cat_var_s) <span class="sc">+</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(num_var_s)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test the `census_plot` function on <code>SEX</code> and <code>AGEP</code> variables per the default <code>api_query</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_plot</span>(<span class="at">cat_var_s =</span> <span class="st">"SEX"</span>, <span class="at">num_var_s =</span> <span class="st">"AGEP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_1_558_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="investigative-task" class="level2">
<h2 class="anchored" data-anchor-id="investigative-task">Investigative Task</h2>
<p>We wanted to investigate if <code>JWDP</code> (time departure for work), <code>JWAP</code> (time arrival at work), and <code>JWMNP</code> (travel time to work) were different (on average) between <code>SEX</code> (male and female) given <code>STATE</code> = 11 for the year 2021. In particular, 2021 was in the midst of COVID and a lot of interesting trends emerged. Whilst more complicated statistical measures would be required to find the true answer, we will just observe final boxplots!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#query the api with the desired year and numerical and categorical variables</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">api_query</span>(<span class="at">surv_year =</span> <span class="fu">c</span>(<span class="st">"2021"</span>), <span class="at">num_var =</span> <span class="fu">c</span>(<span class="st">"JWDP"</span>,<span class="st">"JWAP"</span>,<span class="st">"JWMNP"</span>), <span class="at">cat_var =</span> (<span class="st">"SEX"</span>), <span class="at">condition=</span><span class="cn">NULL</span>, <span class="at">geo_subset=</span> <span class="st">"STATE:11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://api.census.gov/data/2021/acs/acs1/pums?get=PWGTP,JWDP,JWAP,JWMNP,SEX,&amp;for=STATE:11"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$num_var
[1] "JWDP"  "JWAP"  "JWMNP"

$cat_var
[1] "SEX"

$census_tib
# A tibble: 7,162 × 6
   PWGTP JWMNP state JWAP   JWDP   SEX   
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;time&gt; &lt;time&gt; &lt;chr&gt; 
 1    55     0 11       NA     NA  Male  
 2   156     0 11       NA     NA  Male  
 3     6     0 11       NA     NA  Female
 4    28     0 11       NA     NA  Female
 5    27     0 11       NA     NA  Male  
 6    69     0 11       NA     NA  Female
 7    68     0 11       NA     NA  Male  
 8    31     0 11       NA     NA  Male  
 9    83     0 11       NA     NA  Male  
10     5     0 11       NA     NA  Female
# ℹ 7,152 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary function takes defaults</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">census_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sample_means
$sample_means$JWMNP
[1] 7.742825

$sample_means$JWAP
09:21:33

$sample_means$JWDP
05:05:36


$sample_sds
$sample_sds$JWMNP
[1] 16.4837

$sample_sds$JWAP
03:46:34

$sample_sds$JWDP
02:16:08


$all_counts
$all_counts$SEX
# A tibble: 2 × 2
  SEX    count
  &lt;chr&gt;  &lt;int&gt;
1 Female   985
2 Male     964</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run plot function with 3 different numerical variables for 3 boxplots</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">census_plot</span>(census_tib, <span class="at">num_var_s =</span> <span class="fu">c</span>(<span class="st">"JWDP"</span>), <span class="at">cat_var_s =</span> <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_1_558_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_plot</span>(census_tib, <span class="at">num_var_s =</span> <span class="fu">c</span>(<span class="st">"JWAP"</span>), <span class="at">cat_var_s =</span> <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_1_558_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_plot</span>(census_tib, <span class="at">num_var_s =</span> <span class="fu">c</span>(<span class="st">"JWMNP"</span>), <span class="at">cat_var_s =</span> <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_1_558_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the boxplots alone, we see a very slight difference in females vs males in <code>JWAP</code>, where females on average appear to arrive at work slightly later than men. In <code>JWMNP</code> , we notice that females are largely more concentrated around shorter travel times to work, whereas men may take longer to travel to work on average. Notice the indecisive language, we would have to do more robust statistical testing to find out if there were actually significant differences between groups!</p>
</section>
<section id="project-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="project-conclusion">Project Conclusion</h2>
<p>Our goal was to write functions that would manipulate and process data sets that came from a census API. We queried the Public Use Microdata Sample (PUMS) Census API, creating a function that allowed the user to call the API with different combinations of variables. We then created generic functions to automatically summarize and plot certain returned data, providing numerical and graphical summaries. Lastly, we wrote up this document via quarto to describe our thought process and give examples of using the functions, and published an HTML report.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>